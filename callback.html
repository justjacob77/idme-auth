const tokenResponse = await fetch('/api/exchange-token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    code: authCode,
    redirect_uri: 'https://idme-auth-justjacob77s-projects.vercel.app/callback.html',
  }),
});

if (!tokenResponse.ok) {
  throw new Error('Failed to exchange token');
}

const tokenData = await tokenResponse.json();
const accessToken = tokenData.access_token;

// Use the access token to get the user's profile
const profileResponse = await fetch('https://api.id.me/api/public/v3/attributes.json', {
  method: 'GET',
  headers: {
    Authorization: `Bearer ${accessToken}`,
  },
});

if (!profileResponse.ok) {
  throw new Error('Failed to fetch profile');
}

const profileData = await profileResponse.json();
document.body.innerHTML += `<h2>User Name:</h2><p>${profileData.name}</p>`;
